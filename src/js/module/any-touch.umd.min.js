!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).AnyTouch=e()}(this,(function(){"use strict";var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};function e(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var n=function(){return(n=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function i(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}var r=function(){function t(){this.listenersMap={}}return t.prototype.target=function(t){var e=this;return{on:function(n,i){e.on(n,i,{target:t})}}},t.prototype.on=function(t,e,n){var i=(void 0===n?{}:n).target;void 0===this.listenersMap[t]&&(this.listenersMap[t]=[]),void 0!==i&&(e.target=i),this.listenersMap[t].push(e)},t.prototype.off=function(t,e){var n=this.listenersMap[t];if(void 0!==n)if(void 0===e)delete this.listenersMap[t];else{var i=n.findIndex((function(t){return t===e}));n.splice(i,1)}},t.prototype.emit=function(t,e,n){var o,r;void 0===n&&(n=function(){return!0});var s=this.listenersMap[t];if(void 0!==s&&0<s.length)try{for(var a=i(s),u=a.next();!u.done;u=a.next()){var c=u.value;n({target:c.target})&&c(e)}}catch(t){o={error:t}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}},t.prototype.destroy=function(){this.listenersMap={}},t}(),s=Object.prototype.toString;var a="cancel",u="end",c="touch"+u,p="touch"+a,h="ontouchstart"in window,l="start",v="move",f=u,d="r",m="f",y=a;function g(t){return Math.round(100*t)/100}var T=function(){},M=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.load=function(t){var e=[],n=Array.from(t.touches).map((function(t){var n=t.clientX,i=t.clientY,o=t.target;return e.push(o),{clientX:n,clientY:i,target:o}})),i=Array.from(t.changedTouches).map((function(t){return{clientX:t.clientX,clientY:t.clientY,target:t.target}}));return{inputType:t.type.replace("touch",""),changedPoints:i,points:n,nativeEvent:t,target:t.target,targets:e}},n}(T),x=function(t){function n(){var e=t.call(this)||this;return e.target=null,e.isPressed=!1,e}return e(n,t),n.prototype.load=function(t){var e,n=t.clientX,i=t.clientY,o=t.type,r=t.button,s=t.target,a=[{clientX:n,clientY:i,target:s}];"mousedown"===o&&0===r?(this.target=s,this.isPressed=!0,e="start"):this.isPressed&&("mousemove"===o?e="move":"mouseup"===o&&(a=[],e=u,this.isPressed=!1));var c=this.prevPoints||[{clientX:n,clientY:i,target:s}];if(this.prevPoints=[{clientX:n,clientY:i,target:s}],void 0!==e)return{inputType:e,changedPoints:c,points:a,target:this.target,targets:[this.target],nativeEvent:t}},n}(T),b=function(){function t(){var t=h?M:x;this.adapter=new t,this.id=0}return t.prototype.transform=function(t){this.prevInput=this.activeInput;var e=this.adapter.load(t);if(void 0!==e){var i=Number.MAX_SAFE_INTEGER>this.id?++this.id:1,o=function(t){var e=t.inputType,i=t.points,o=t.changedPoints,r=t.nativeEvent,s=i.length,c="start"===e,p=u===e&&0===s||a===e,h=performance.now(),l=E(i)||E(o),v=l.x,f=l.y,d=r.currentTarget;return n(n({},t),{x:v,y:f,timestamp:h,isStart:c,isEnd:p,pointLength:s,currentTarget:d,getOffset:function(t){void 0===t&&(t=d);var e=t.getBoundingClientRect();return{x:v-Math.round(e.left),y:f-Math.round(e.top)}}})}(n(n({},e),{id:i}));this.activeInput=o;var r=o.isStart,s=o.pointLength;return r&&(this.startInput=o,this.prevInput=void 0,this.startMultiInput=1<s?o:void 0),n(n({},o),{prevInput:this.prevInput,startMultiInput:this.startMultiInput,startInput:this.startInput})}},t}();function E(t){var e=t.length;if(0<e){if(1===e){var n=t[0],i=n.clientX,o=n.clientY;return{x:Math.round(i),y:Math.round(o)}}var r=t.reduce((function(t,e){return t.x+=e.clientX,t.y+=e.clientY,t}),{x:0,y:0});return{x:Math.round(r.x/e),y:Math.round(r.y/e)}}}function P(t,e,n){e.target,e.currentTarget;var i,o=e.type,r=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]])}return n}(e,["target","currentTarget","type"]);return void 0!==Event?i=new Event(o,n):(i=document.createEvent("HTMLEvents")).initEvent(o,null==n?void 0:n.bubbles,null==n?void 0:n.cancelable),Object.assign(i,r,{match:function(){return e.targets.every((function(t){return i.currentTarget.contains(t)}))}}),t.dispatchEvent(i)}function w(t,e){if(!e.isPreventDefault)return!1;var n,i=!0;if(null!==t.target){var o=e.preventDefaultExclude;if(n=o,"[object RegExp]"===s.call(n)){if("tagName"in t.target){var r=t.target.tagName;i=!o.test(r)}}else(function(t){return"[object Function]"===s.call(t)})(o)&&(i=!o(t))}return i}var L=["touchstart","touchmove",c,p];function z(t,e,n){var i=null==n?void 0:n.name;if(void 0===i||void 0===t.recognizerMap[i]){var o=new e(n);t.recognizerMap[o.name]=o,o.recognizerMap=t.recognizerMap,t.recognizers.push(t.recognizerMap[o.name])}}function _(t,e){var n,r;if(void 0===e)t.recognizers=[],t.recognizerMap={};else try{for(var s=i(t.recognizers.entries()),a=s.next();!a.done;a=s.next()){var u=o(a.value,2),c=u[0];if(e===u[1].options.name){t.recognizers.splice(c,1),delete t.recognizerMap[e];break}}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}function I(t,e){var i=e.type,o=e.target,r=e.targets;t.emit(i,e,(function(t){if(void 0!==(null==t?void 0:t.target)){var e=t.target;return r.every((function(t){return e.contains(t)}))}return!0}));t.emit("at:after",e),t.options.domEvents&&void 0!==t.el&&null!==o&&(P(o,e,t.options.domEvents),P(o,n(n({},e),{type:"at:after"}),t.options.domEvents))}var S={domEvents:{bubbles:!0,cancelable:!0},isPreventDefault:!0,preventDefaultExclude:/^(?:INPUT|TEXTAREA|BUTTON|SELECT)$/},O=function(t){function o(e,i){var r=t.call(this)||this;if(r.recognizerMap={},r.recognizers=[],r.cacheComputedFunctionGroup=Object.create(null),r.el=e,r.input=new b,r.options=n(n({},S),i),r.recognizerMap=o.recognizerMap,r.recognizers=o.recognizers,void 0!==e){e.style.webkitTapHighlightColor="rgba(0,0,0,0)";var s=!1;try{var a={};Object.defineProperty(a,"passive",{get:function(){s=!0}}),window.addEventListener("_",(function(){}),a)}catch(t){}r.on("unbind",function(t,e,n){return h?(L.forEach((function(i){t.addEventListener(i,e,n)})),function(){L.forEach((function(n){t.removeEventListener(n,e)}))}):(t.addEventListener("mousedown",e,n),window.addEventListener("mousemove",e,n),window.addEventListener("mouseup",e,n),function(){t.removeEventListener("mousedown",e),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",e)})}(e,r.catchEvent.bind(r),!(r.options.isPreventDefault||!s)&&{passive:!0}))}return r}return e(o,t),o.prototype.use=function(t,e){z(this,t,e)},o.prototype.removeUse=function(t){_(this,t)},o.prototype.catchEvent=function(t){var e,o,r=this;w(t,this.options)&&t.preventDefault();var s=this.input.transform(t);if(void 0!==s){var a="at:touch"+s.inputType;this.emit("at:touch",s),this.emit(a,s);var u=this.options.domEvents;if(!1!==u){var c=t.target;null!==c&&(P(c,n(n({},s),{type:"at:touch"}),u),P(c,n(n({},s),{type:a}),u))}var p=Object.create(null),h=function(t){if(t.disabled)return"continue";t.computedGroup=p,t.computeFunctionMap=l.cacheComputedFunctionGroup,t.recognize(s,(function(e,i){var o=n(n(n({},s),i),{type:e,baseType:t.name});Object.freeze(o),void 0===r.beforeEachHook?I(r,o):r.beforeEachHook(t,(function(){I(r,o)}))})),p=t.computedGroup,l.cacheComputedFunctionGroup=t.computeFunctionMap},l=this;try{for(var v=i(this.recognizers),f=v.next();!f.done;f=v.next()){h(f.value)}}catch(t){e={error:t}}finally{try{f&&!f.done&&(o=v.return)&&o.call(v)}finally{if(e)throw e.error}}}},o.prototype.beforeEach=function(t){this.beforeEachHook=t},o.prototype.get=function(t){return this.recognizerMap[t]},o.prototype.set=function(t){this.options=n(n({},this.options),t)},o.prototype.destroy=function(){this.emit("unbind"),this.listenersMap={}},o.version="0.7.0",o.recognizers=[],o.recognizerMap={},o.use=function(t,e){z(o,t,e)},o.removeUse=function(t){_(o,t)},o}(r);function D(t){-1!==[f,y,d,m].indexOf(t.status)&&(t.status="p")}function X(t,e,n){var i=t.test(e);D(t);var o=e.inputType;t.status=function(t,e,n){var i,o,r,s,c,p,h,d={1:(i={},i.p=(o={},o.move=l,o),i[l]=(r={},r.move=v,r[u]=f,r[a]=y,r),i[v]=(s={},s.move=v,s[u]=f,s[a]=y,s),i),0:(c={},c[l]=(p={},p.move=y,p[u]=f,p[a]=y,p),c[v]=(h={},h.start=m,h.move=y,h[u]=f,h[a]=y,h),c)};return void 0!==d[Number(t)][e]&&d[Number(t)][e][n]||e}(i,t.status,o);var r=t.computed;t.isRecognized=[l,v].includes(t.status);var s=t.name,c=t.status,p=t.isRecognized;return p&&n(s,r),(p||[f,y].includes(t.status))&&n(s+c,r),i}var V=function(){function t(t){this.disabled=!1,this.status="p",this.isRecognized=!1,this.recognizerMap={},this.computedGroup={},this.computed={},this.computeFunctionMap={},this.options=t,this.name=this.options.name}return t.prototype.set=function(t){return void 0!==t&&(this.options=n(n({},this.options),t)),this},t.prototype.isValidPointLength=function(t){return 0===this.options.pointLength||this.options.pointLength===t},t.prototype.compute=function(t,e){var n,o,r=Object.create(null);try{for(var s=i(t),a=s.next();!a.done;a=s.next()){var u=a.value,c=u._id,p=this.computedGroup,h=this.computeFunctionMap;for(var l in void 0===h[c]&&(h[c]=u()),p[c]=p[c]||h[c](e),p[c])r[l]=p[c][l]}}catch(t){n={error:t}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}return r},t}(),Y=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},A=function(t){return t/Math.PI*180},C=function(t,e){var n=function(t,e){var n=Y(t)*Y(e);if(0===n)return 0;var i=function(t,e){return t.x*e.x+t.y*e.y}(t,e)/n;return i>1&&(i=1),Math.acos(i)}(t,e);return function(t,e){return t.x*e.y-e.x*t.y}(t,e)>0&&(n*=-1),A(n)},F=function(t,e){return t===e?"none":Math.abs(t)>Math.abs(e)?0<t?"right":"left":0<e?"down":"up"};function j(){return function(t){var e=t.prevInput,n=0,i=0,o=0;if(void 0!==e&&(n=t.x-e.x,i=t.y-e.y,0!==n||0!==i)){var r=Math.sqrt(Math.pow(n,2)+Math.pow(i,2));o=Math.round(A(Math.acos(Math.abs(n)/r)))}return{deltaX:n,deltaY:i,deltaXYAngle:o}}}function N(){var t=0,e=0,n=0,i=0,o=0,r="none";return function(s){var a=s.inputType,u=s.startInput;return"start"===a?(t=0,e=0,n=0,i=0,o=0,r="none"):"move"===a&&(t=Math.round(s.points[0].clientX-u.points[0].clientX),e=Math.round(s.points[0].clientY-u.points[0].clientY),n=Math.abs(t),i=Math.abs(e),o=Math.round(Y({x:n,y:i})),r=F(t,e)),{displacementX:t,displacementY:e,distanceX:n,distanceY:i,distance:o,overallDirection:r}}}function R(){var t=0;return function(e){return"start"===e.inputType&&(t=e.pointLength),{maxPointLength:t}}}function U(){var t,e,n=0,i=0,o=0,r=0;return function(s){if(void 0!==s){var a=s.inputType;e=e||s.startInput;var u=s.timestamp-e.timestamp;if("move"===a&&16<u){var c=s.x-e.x,p=s.y-e.y;o=Math.round(c/u*100)/100,r=Math.round(p/u*100)/100,n=Math.abs(o),i=Math.abs(r),t=F(c,p)||t,e=s}}return{velocityX:n,velocityY:i,speedX:o,speedY:r,direction:t}}}function G(t){return{x:t.points[1].clientX-t.points[0].clientX,y:t.points[1].clientY-t.points[0].clientY}}function k(){return function(t){var e=t.prevInput,n=t.startMultiInput;if(void 0!==n&&void 0!==e&&t.id!==n.id&&1<t.pointLength)return{startV:G(n),prevV:G(e),activeV:G(t)}}}j._id="ComputeDeltaXY",N._id="computeDistance",R._id="computeMaxLength",U._id="ComputeVAndDir",k._id="ComputeVectorForMutli";var H={name:"tap",pointLength:1,tapTimes:1,waitNextTapTime:300,maxDistance:2,maxDistanceFromPrevTap:9,maxPressTime:250},B=function(t){function i(e){var i=t.call(this,n(n({},H),e))||this;return i.tapCount=0,i}return e(i,t),i.prototype._isValidDistanceFromPrevTap=function(t){if(void 0!==this.prevTapPoint){var e=Y({x:t.x-this.prevTapPoint.x,y:t.y-this.prevTapPoint.y});return this.prevTapPoint=t,this.options.maxDistanceFromPrevTap>=e}return this.prevTapPoint=t,!0},i.prototype._isValidInterval=function(){var t=performance.now();if(void 0===this.prevTapTime)return this.prevTapTime=t,!0;var e=t-this.prevTapTime;return this.prevTapTime=t,e<this.options.waitNextTapTime},i.prototype.recognize=function(t,e){var i=t.inputType,o=t.x,r=t.y;this.computed=this.compute([R,N],t),u===i&&(this.status="p",this.test(t)?(this.cancelCountDownToFail(),this._isValidDistanceFromPrevTap({x:o,y:r})&&this._isValidInterval()?this.tapCount++:this.tapCount=1,0==this.tapCount%this.options.tapTimes?(this.status=d,e(this.options.name,n(n({},this.computed),{tapCount:this.tapCount})),this.reset()):this.countDownToFail()):(this.reset(),this.status=m))},i.prototype.countDownToFail=function(){var t=this;this._countDownToFailTimer=setTimeout((function(){t.status=m,t.reset()}),this.options.waitNextTapTime)},i.prototype.cancelCountDownToFail=function(){clearTimeout(this._countDownToFailTimer)},i.prototype.reset=function(){this.tapCount=0,this.prevTapPoint=void 0,this.prevTapTime=void 0},i.prototype.test=function(t){var e=t.startInput,n=t.timestamp-e.timestamp,i=this.computed,o=i.maxPointLength,r=i.distance;return o===this.options.pointLength&&this.options.maxDistance>=r&&this.options.maxPressTime>n},i}(V),q={name:"pan",threshold:10,pointLength:1},Z=function(t){function i(e){return t.call(this,n(n({},q),e))||this}return e(i,t),i.prototype.test=function(t){var e=t.pointLength,n=this.computed.distance;return(this.isRecognized||this.options.threshold<=n)&&this.isValidPointLength(e)},i.prototype.recognize=function(t,e){this.computed=this.compute([U,N,j],t),void 0!==this.computed.direction&&X(this,t,e)&&e(this.options.name+this.computed.direction,this.computed)},i}(V),$={name:"swipe",threshold:10,velocity:.3,pointLength:1},J=function(t){function i(e){return t.call(this,n(n({},$),e))||this}return e(i,t),i.prototype.test=function(t){var e=t.inputType;if(u!==e)return!1;var n=this.computed,i=n.velocityX,o=n.velocityY,r=n.maxPointLength,s=n.distance;return this.options.pointLength===r&&this.options.threshold<s&&this.options.velocity<Math.max(i,o)},i.prototype.recognize=function(t,e){this.computed=this.compute([R,U,N],t),this.test(t)&&(e(this.options.name,this.computed),e(this.options.name+this.computed.direction,this.computed))},i}(V),K={name:"press",pointLength:1,maxDistance:9,minPressTime:251},Q=function(t){function i(e){return t.call(this,n(n({},K),e))||this}return e(i,t),i.prototype.recognize=function(t,e){var n=this,i=t.inputType,o=t.startInput,r=t.pointLength;if("start"===i&&this.isValidPointLength(r))D(this),this.cancel(),this._timeoutId=setTimeout((function(){n.status=d,e(n.options.name,t)}),this.options.minPressTime);else if(u===i&&d===this.status)e(this.options.name+"up",this.computed);else{var s=t.timestamp-o.timestamp;(!this.test(t)||this.options.minPressTime>s&&[u,a].includes(i))&&(this.cancel(),this.status=m)}},i.prototype.test=function(t){this.computed=this.compute([N],t);var e=this.computed.distance;return this.options.maxDistance>e},i.prototype.cancel=function(){clearTimeout(this._timeoutId)},i}(V),W={name:"pinch",threshold:0,pointLength:2},tt=function(t){function i(e){return t.call(this,n(n({},W),e))||this}return e(i,t),i.prototype.test=function(t){var e=t.pointLength,n=this.computed.scale;return this.isValidPointLength(e)&&void 0!==n&&(this.options.threshold<Math.abs(n-1)||this.isRecognized)},i.prototype.recognize=function(t,e){var i,o,r,s,a,u=this.compute([k],t);"activeV"in u&&(this.computed=n(n({},this.computed),(o=(i=u).startV,r=i.prevV,s=i.activeV,a=g(Y(s)/Y(r)),{scale:g(Y(s)/Y(o)),deltaScale:a}))),X(this,t,e)},i}(V),et={name:"rotate",threshold:0,pointLength:2},nt=function(t){function i(e){return t.call(this,n(n({},et),e))||this}return e(i,t),i.prototype.test=function(t){var e=t.pointLength,n=this.computed.angle;return this.isValidPointLength(e)&&(this.options.threshold<Math.abs(n)||this.isRecognized)},i.prototype.recognize=function(t,e){var i,o,r,s,a,u=this.compute([k],t);"activeV"in u&&(this.computed=n(n({},this.computed),(o=(i=u).startV,r=i.prevV,s=i.activeV,a=Math.round(C(s,r)),{angle:Math.round(C(s,o)),deltaAngle:a}))),X(this,t,e)},i}(V);return O.use(B),O.use(Z),O.use(J),O.use(Q),O.use(tt),O.use(nt),O.Tap=B,O.Pan=Z,O.Swipe=J,O.Press=Q,O.Pinch=tt,O.Rotate=nt,O.STATUS_POSSIBLE="p",O.STATUS_START=l,O.STATUS_MOVE=v,O.STATUS_END=f,O.STATUS_CANCELLED=y,O.STATUS_FAILED=m,O.STATUS_RECOGNIZED=d,O}));
